<!-- ================== reponse.html ================== -->
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RÃ©ponse - Jeu de piste</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <h2 id="resultat"></h2>
    <p id="message"></p>
    <a id="btnSuivante" class="btn" href="#" style="display:none;">Ã‰tape suivante</a>
    <button id="retourBtn" class="btn" style="display:none;">ğŸ”™ Retour Ã  l'Ã©tape</button>
	    <audio id="musique" loop></audio>

  </div>

  <script src="data.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      // Ã‰tape actuelle depuis localStorage
      let etapeMax = parseInt(localStorage.getItem("etape_max") || "1", 10);

      // RÃ©ponse scannÃ©e depuis le QR code
      const params = new URLSearchParams(window.location.search);
      const rep = params.get("rep");

      const resultat = document.getElementById("resultat");
      const message = document.getElementById("message");
      const btnSuivante = document.getElementById("btnSuivante");
      const retourBtn = document.getElementById("retourBtn");
	  const musiqueEl = document.getElementById("musique");


      retourBtn.addEventListener("click", () => {
        window.history.back();
      });

      const etape = etapes[etapeMax];

      if (!etape) {
        resultat.innerText = "â›” Ã‰tape inconnue";
        message.innerText = "Cette Ã©tape n'existe pas.";
        retourBtn.style.display = "inline-block";
      } else if (rep === etape.reponse) {
        // Bonne rÃ©ponse pour l'Ã©tape actuelle
        if (etape.suivante) {
          etapeMax = etape.suivante;
          localStorage.setItem("etape_max", etapeMax.toString());
          resultat.innerHTML = "âœ… "+etape.message;
          btnSuivante.href = `etape.html?id=${etapeMax}`;
          btnSuivante.style.display = "inline-block";
        } else {
          resultat.innerHTML = "ğŸ‰ "+etape.message;
		  if(localStorage.getItem("musiqueDemarree") === "true" && etape.music) {
          musiqueEl.src = "audio/fin.mp3"
          musiqueEl.play().catch(err => console.log("Lecture musique sur ÃƒÂ©tape :", err));
        }
        }
      } else {
        // Mauvaise rÃ©ponse
        resultat.innerText = "âŒ Mauvaise rÃ©ponse";
        resultat.innerHTML = "Ce nâ€™est pas le bon QR code pour cette Ã©tape.";
        retourBtn.style.display = "inline-block";
      }
    });
  </script>
</body>
</html>